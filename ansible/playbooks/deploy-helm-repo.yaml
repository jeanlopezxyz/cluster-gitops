---
# Deploy Helm Repository on Bastion
# Red Hat Consulting

- name: Deploy Helm Chart Repository on Bastion
  hosts: bastion
  gather_facts: true

  vars:
    bastion_host: "{{ ansible_host }}"

  pre_tasks:
    - name: Verify we are running on bastion
      ansible.builtin.debug:
        msg: "ğŸš€ Deploying Helm repository on {{ inventory_hostname }}"

  roles:
    - helm-repository

  post_tasks:
    - name: Display Helm repository information
      ansible.builtin.debug:
        msg: |
          ========================================
          âœ… Helm Repository Deployed!
          ========================================

          ğŸ“ Repository URL:
            http://{{ bastion_host }}:{{ helm_repo.chartmuseum.port }}/charts

          ğŸ“ To add this repository:
            helm repo add day2-charts http://{{ bastion_host }}:{{ helm_repo.chartmuseum.port }}/charts
            helm repo update

          ğŸ” To verify charts:
            helm search repo day2-charts

          ğŸ“¦ API endpoint:
            http://{{ bastion_host }}:{{ helm_repo.chartmuseum.port }}/api/charts

          ========================================
